flowchart TD
    A[ðŸ“ File Upload Request] --> B{ðŸ“ File Validation}
    B -->|âœ… Pass| C[ðŸ” Generate SHA256 Hash]
    B -->|âŒ Size > 50MB| Z1[âŒ File Too Large Error]
    B -->|âŒ Invalid Type| Z2[âŒ Invalid File Type Error]
    
    C --> D[ðŸ“‹ Extract Metadata<br/>â€¢ MIME Type<br/>â€¢ File Size<br/>â€¢ EXIF Data]
    D --> E[ðŸ” Check Duplicates]
    E -->|âœ… Unique| F[ðŸŒ Upload to IPFS]
    E -->|âŒ Exists| Z3[âŒ Duplicate File Error]
    
    F --> G{ðŸŒ IPFS Success?}
    G -->|âœ… Yes| H[ðŸ“ Get IPFS Hash CID]
    G -->|âŒ No| Y1[ðŸ”„ Retry Different Node]
    Y1 --> F
    
    H --> I[ðŸ’¾ Save to MongoDB<br/>â€¢ Content Hash<br/>â€¢ IPFS Hash<br/>â€¢ Metadata<br/>â€¢ Timestamps]
    I --> J{ðŸ—„ï¸ Database Success?}
    J -->|âœ… Yes| K[â›“ï¸ Register on Blockchain]
    J -->|âŒ No| Y2[ðŸ”„ Retry Database Operation]
    Y2 --> I
    
    K --> L[ðŸ“ Call registerMedia Smart Contract]
    L --> M{â›“ï¸ Transaction Success?}
    M -->|âœ… Yes| N[ðŸ“¡ Listen for Events]
    M -->|âŒ Gas Failed| Y3[âš¡ Adjust Gas & Retry]
    M -->|âŒ Network Error| Y4[ðŸŒ Switch RPC & Retry]
    Y3 --> L
    Y4 --> L
    
    N --> O[âœ… Success Response<br/>â€¢ File Hash<br/>â€¢ IPFS Hash<br/>â€¢ Transaction Hash<br/>â€¢ Block Number]
    
    %% Error Paths
    Z1 --> P[ðŸ’¡ Suggest File Compression]
    Z2 --> Q[ðŸ“‹ Show Supported Formats]
    Z3 --> R[ðŸ”— Link to Existing Content]
    
    %% Styling
    style A fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    style C fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    style F fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    style I fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    style K fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    style O fill:#e8f5e8,stroke:#2e7d32,stroke-width:3px
    style Z1 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style Z2 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    style Z3 fill:#ffebee,stroke:#d32f2f,stroke-width:2px
