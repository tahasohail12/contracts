sequenceDiagram
    participant S as ğŸª Seller
    participant F as ğŸ’» Frontend
    participant BC as â›“ï¸ Smart Contract
    participant B as ğŸ›’ Buyer
    participant T as ğŸ’° Treasury
    
    Note over S,T: NFT Marketplace Transaction Flow
    
    %% Listing Phase
    S->>F: ğŸ’° Set Price & List NFT
    F->>F: âœ… Validate Ownership
    F->>BC: ğŸ“ Call listForSale(tokenId, price)
    BC->>BC: ğŸ” Verify Owner<br/>âœ… Check Not Listed<br/>ğŸ’° Validate Price > 0
    BC->>BC: ğŸ“Š Update Listing State
    BC-->>F: âœ… NFT Listed Successfully
    F-->>S: ğŸ‰ Listed on Marketplace
    
    %% Discovery Phase  
    B->>F: ğŸ” Browse Marketplace
    F->>BC: ğŸ“Š Query Active Listings
    BC-->>F: ğŸ“‹ Return Available NFTs
    F-->>B: ğŸ–¼ï¸ Display Gallery
    
    %% Purchase Phase
    B->>F: ğŸ›’ Click "Buy NFT"
    F->>F: ğŸ”— Connect Wallet
    F->>BC: ğŸ’° Call buyNFT(tokenId) + ETH
    
    BC->>BC: ğŸ’³ Process Payment<br/>â€¢ Validate Payment Amount<br/>â€¢ Calculate Fees<br/>â€¢ Transfer NFT Ownership
    
    %% Payment Distribution
    BC->>S: ğŸ’° 95% to Seller
    BC->>BC: ğŸ’° 2.5% Creator Royalty
    BC->>T: ğŸ’° 2.5% Platform Fee
    
    BC->>BC: ğŸ“Š Update State<br/>â€¢ Remove Listing<br/>â€¢ Transfer Token<br/>â€¢ Emit Events
    
    BC-->>F: âœ… Purchase Complete
    F-->>B: ğŸ‰ NFT Received
    F-->>S: ğŸ’° Payment Received
    
    Note over S,T: Error Scenarios
    
    B->>BC: ğŸ’° Insufficient Payment
    BC-->>F: âŒ Payment Too Low Error
    F-->>B: ğŸ’¡ Show Required Amount
    
    B->>BC: ğŸ”„ NFT Already Sold
    BC-->>F: âŒ No Longer Available
    F-->>B: ğŸ”„ Refresh Listings
